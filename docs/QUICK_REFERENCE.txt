╔══════════════════════════════════════════════════════════════════════════════╗
║                    🚀 NovaChain Plugin - Quick Reference                    ║
╠══════════════════════════════════════════════════════════════════════════════╣
║                                                                              ║
║  📍 API ENDPOINT                                                             ║
║  ────────────────────────────────────────────────────────────────────────    ║
║  https://mjeqsapfdnpufhkquzhn.supabase.co/functions/v1/                     ║
║    external-energy-transfer                                                  ║
║                                                                              ║
║  🔐 AUTHENTICATION                                                           ║
║  ────────────────────────────────────────────────────────────────────────    ║
║  Header: x-api-key: <your-secret-key>                                       ║
║                                                                              ║
║  ⚙️  SETUP SCHRITTE                                                          ║
║  ────────────────────────────────────────────────────────────────────────    ║
║  1. API Key generieren:                                                      ║
║     $ openssl rand -hex 32                                                   ║
║                                                                              ║
║  2. Supabase Secret setzen:                                                  ║
║     $ npx supabase secrets set \                                             ║
║       EXTERNAL_TRANSFER_API_KEY=<generated-key>                              ║
║                                                                              ║
║  3. Discourse Admin Settings:                                                ║
║     URL: https://nova-chain.io/admin/site_settings/category/plugins         ║
║     - novachain_enabled: ✅ aktiviert                                        ║
║     - novachain_api_key: <same-generated-key>                                ║
║                                                                              ║
║  ⚡ ENERGY POINTS SYSTEM                                                     ║
║  ────────────────────────────────────────────────────────────────────────    ║
║  Topic erstellen:        +5 EP                                               ║
║  Post erstellen:         +3 EP                                               ║
║  Solution accepted:      +8 EP                                               ║
║  Badge erhalten:         +4 EP                                               ║
║  Like vergeben:          +2 EP                                               ║
║  Like erhalten:          +1 EP                                               ║
║  Daily Visit:            +1 EP                                               ║
║                                                                              ║
║  🔄 AUTO-TRANSFER                                                            ║
║  ────────────────────────────────────────────────────────────────────────    ║
║  Schwellwert: 5000 EP                                                        ║
║  Trigger:     Automatisch nach jeder Aktivität                               ║
║  Bedingung:   User muss Wallet verknüpft haben                               ║
║                                                                              ║
║  📝 REQUEST FORMAT                                                           ║
║  ────────────────────────────────────────────────────────────────────────    ║
║  {                                                                           ║
║    "action": "transfer",                                                     ║
║    "wallet_address": "0xeb3c3cb8df4b76e88739db345fb92bd38e6840d3",           ║
║    "energy_amount": 5000,                                                    ║
║    "user_id": 123,                                                           ║
║    "username": "joe69",                                                      ║
║    "timestamp": 1727823456,                                                  ║
║    "source": "discourse_forum"                                               ║
║  }                                                                           ║
║                                                                              ║
║  ✅ SUCCESS RESPONSE                                                         ║
║  ────────────────────────────────────────────────────────────────────────    ║
║  {                                                                           ║
║    "success": true,                                                          ║
║    "message": "Energy points transferred successfully",                      ║
║    "data": {                                                                 ║
║      "wallet_address": "0x...",                                              ║
║      "previous_balance": 1000,                                               ║
║      "transferred_amount": 5000,                                             ║
║      "new_balance": 6000                                                     ║
║    }                                                                         ║
║  }                                                                           ║
║                                                                              ║
║  🔍 MONITORING                                                               ║
║  ────────────────────────────────────────────────────────────────────────    ║
║  Plugin Logs:                                                                ║
║  $ sudo docker exec app tail -f \                                            ║
║    /var/www/discourse/log/production.log | grep NovaChain                    ║
║                                                                              ║
║  Transfer Logs:                                                              ║
║  $ sudo docker exec app tail -f \                                            ║
║    /var/www/discourse/log/production.log | grep AUTO-TRANSFER                ║
║                                                                              ║
║  Supabase Query:                                                             ║
║  SELECT * FROM energy_actions                                                ║
║  WHERE action_key = 'external_transfer'                                      ║
║  ORDER BY created_at DESC;                                                   ║
║                                                                              ║
║  🧪 TESTING                                                                  ║
║  ────────────────────────────────────────────────────────────────────────    ║
║  cURL Test:                                                                  ║
║  $ curl -X POST \                                                            ║
║    https://mjeqsapfdnpufhkquzhn.supabase.co/functions/v1/\                   ║
║    external-energy-transfer \                                                ║
║    -H "Content-Type: application/json" \                                     ║
║    -H "x-api-key: YOUR_KEY" \                                                ║
║    -d '{"action":"transfer","wallet_address":"0x...","energy_amount":100}'   ║
║                                                                              ║
║  Python Test:                                                                ║
║  $ cd /opt/novachain-community                                               ║
║  $ python3 test_external_transfer.py                                         ║
║                                                                              ║
║  🛠️  COMMON ISSUES                                                           ║
║  ────────────────────────────────────────────────────────────────────────    ║
║  401 Unauthorized:                                                           ║
║    → API Key falsch/nicht gesetzt                                            ║
║    → Prüfe Supabase Secret + Discourse Setting                               ║
║                                                                              ║
║  400 Bad Request:                                                            ║
║    → Required fields fehlen (wallet_address/energy_amount/source)            ║
║    → Amount > 10000 (API Limit)                                              ║
║                                                                              ║
║  Transfer nicht ausgelöst:                                                   ║
║    → User hat keine Wallet verknüpft                                         ║
║    → POST /novachain/link-wallet {"wallet_address": "0x..."}                 ║
║                                                                              ║
║  📚 DOCUMENTATION                                                            ║
║  ────────────────────────────────────────────────────────────────────────    ║
║  - EXTERNAL_TRANSFER_UPDATE.md  (Vollständige Anleitung)                     ║
║  - test_external_transfer.py    (Automatisierte Tests)                       ║
║  - Plugin: /var/www/discourse/plugins/discourse-novachain-plugin/            ║
║                                                                              ║
║  🚀 STATUS                                                                   ║
║  ────────────────────────────────────────────────────────────────────────    ║
║  Plugin Version:  1.1.0                                                      ║
║  API Status:      ✅ Deployed & Ready                                        ║
║  Last Update:     2025-10-02                                                 ║
║  Unicorn PID:     414410                                                     ║
║                                                                              ║
╚══════════════════════════════════════════════════════════════════════════════╝
